# ç½‘ç»œå—é™ç¯å¢ƒä¸‹çš„éƒ¨ç½²æ–¹æ¡ˆ

## ğŸ“‹ å½“å‰çŠ¶å†µ

ç”±äºç½‘ç»œé™åˆ¶æ— æ³•ä»Docker Hubæ‹‰å–ä»¥ä¸‹é•œåƒï¼š
- âŒ Redis (redis:7-alpine)
- âŒ Zipkin (openzipkin/zipkin:latest)
- âŒ Dapr (daprio/dapr:1.13.0, daprio/daprd:1.13.0)

## âœ… å·²æˆåŠŸéƒ¨ç½²

å½“å‰å·²æˆåŠŸéƒ¨ç½²å¹¶è¿è¡Œçš„æœåŠ¡ï¼š

### 1. åº”ç”¨æœåŠ¡ï¼ˆå®¹å™¨åŒ–ï¼‰
- âœ… **Gateway** - `http://localhost:5000`
  - ç«¯å£: 5000:8080, 50003:50003
  - çŠ¶æ€: è¿è¡Œæ­£å¸¸
  - åŠŸèƒ½: APIç½‘å…³ã€è¯·æ±‚è·¯ç”±

- âœ… **Product Service** - `http://localhost:5001`
  - ç«¯å£: 5001:8080, 50001:50001
  - çŠ¶æ€: è¿è¡Œæ­£å¸¸
  - åŠŸèƒ½: äº§å“ç®¡ç†API

- âœ… **User Service** - `http://localhost:5002`
  - ç«¯å£: 5002:8080, 50002:50002
  - çŠ¶æ€: è¿è¡Œæ­£å¸¸
  - åŠŸèƒ½: ç”¨æˆ·ç®¡ç†API

### 2. æ ¸å¿ƒåŠŸèƒ½
- âœ… REST API ç«¯ç‚¹å…¨éƒ¨å¯ç”¨
- âœ… æœåŠ¡é—´é€šä¿¡ï¼ˆé€šè¿‡å®¹å™¨ç½‘ç»œï¼‰
- âœ… API Gateway è·¯ç”±åŠŸèƒ½
- âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹
- âœ… gRPC ç«¯ç‚¹é…ç½®ï¼ˆè™½æœªä½¿ç”¨Daprï¼‰

## ğŸ”„ æ›¿ä»£æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ä½¿ç”¨å†…å­˜ç»„ä»¶ï¼ˆå½“å‰ï¼‰
å·²åˆ›å»ºçš„å†…å­˜ç»„ä»¶é…ç½®ï¼š
- `deployment/dapr/components/statestore-memory.yaml` - å†…å­˜çŠ¶æ€å­˜å‚¨
- `deployment/dapr/components/pubsub-memory.yaml` - å†…å­˜å‘å¸ƒè®¢é˜…

**ä¼˜ç‚¹**: æ— éœ€å¤–éƒ¨ä¾èµ–
**ç¼ºç‚¹**: é‡å¯ä¸¢å¤±æ•°æ®ï¼Œä¸æ”¯æŒåˆ†å¸ƒå¼

### æ–¹æ¡ˆ2: æ‰‹åŠ¨ä¸‹è½½ç¦»çº¿é•œåƒ
å¦‚æœå¯ä»¥ä»å…¶ä»–æ¸ é“è·å–é•œåƒtaråŒ…ï¼š

```powershell
# å¯¼å…¥é•œåƒ
podman load -i redis-7-alpine.tar
podman load -i zipkin-latest.tar
podman load -i daprd-1.13.0.tar

# ç„¶åè¿è¡Œéƒ¨ç½²è„šæœ¬
.\deploy-podman.ps1 -Action start
```

### æ–¹æ¡ˆ3: ä½¿ç”¨Windowsæœ¬åœ°æœåŠ¡

#### 3.1 å®‰è£…Memurai (Redis for Windows)
```powershell
winget install Memurai.MemuraiDeveloper
```

å¯åŠ¨åå¯åœ¨ `localhost:6379` ä½¿ç”¨

#### 3.2 é…ç½®Daprä½¿ç”¨æœ¬æœºRedis
ä¿®æ”¹ `deployment/dapr/components/statestore.yaml`:
```yaml
spec:
  metadata:
  - name: redisHost
    value: host.docker.internal:6379  # ä»å®¹å™¨è®¿é—®ä¸»æœº
```

### æ–¹æ¡ˆ4: é…ç½®é•œåƒåŠ é€Ÿå™¨ï¼ˆé«˜çº§ï¼‰

#### 4.1 å›½å†…é•œåƒæºåˆ—è¡¨
å¯å°è¯•çš„é•œåƒæºï¼š
- é˜¿é‡Œäº‘: `registry.cn-hangzhou.aliyuncs.com`
- è…¾è®¯äº‘: `mirror.ccs.tencentyun.com`
- ç½‘æ˜“äº‘: `hub-mirror.c.163.com`
- ä¸­ç§‘å¤§: `docker.mirrors.ustc.edu.cn`

#### 4.2 é…ç½®æ–¹æ³•
ç¼–è¾‘Podmanè™šæ‹Ÿæœºé…ç½®ï¼š

```powershell
# åˆ›å»ºé•œåƒæºé…ç½®
podman machine ssh "sudo tee /etc/containers/registries.conf.d/mirrors.conf" << 'EOF'
[[registry]]
prefix = "docker.io"
location = "docker.io"

[[registry.mirror]]
location = "registry.cn-hangzhou.aliyuncs.com"

[[registry.mirror]]
location = "docker.mirrors.ustc.edu.cn"
EOF

# é‡å¯Podmanè™šæ‹Ÿæœº
podman machine stop
podman machine start
```

### æ–¹æ¡ˆ5: ä½¿ç”¨WSL2 + Docker

å¦‚æœWSL2ä¸­æœ‰Dockerï¼š

```bash
# åœ¨WSL2ä¸­æ‹‰å–é•œåƒ
wsl -d Ubuntu-22.04
docker pull redis:7-alpine
docker pull openzipkin/zipkin
docker pull daprio/daprd:1.13.0

# å¯¼å‡ºé•œåƒ
docker save redis:7-alpine -o /mnt/e/redis.tar
docker save openzipkin/zipkin -o /mnt/e/zipkin.tar
docker save daprio/daprd:1.13.0 -o /mnt/e/daprd.tar

# åœ¨Windowsä¸­å¯¼å…¥åˆ°Podman
podman load -i E:\redis.tar
podman load -i E:\zipkin.tar
podman load -i E:\daprd.tar
```

## ğŸ“Š å½“å‰æ¶æ„çŠ¶æ€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Go-Nomads å¾®æœåŠ¡æ¶æ„ (ç®€åŒ–ç‰ˆ)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Gateway  â”‚â”€â”€â”€>â”‚ProductServiceâ”‚      â”‚
â”‚  â”‚ :5000    â”‚    â”‚    :5001     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚       â”‚                                 â”‚
â”‚       â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  User    â”‚                           â”‚
â”‚  â”‚ Service  â”‚                           â”‚
â”‚  â”‚ :5002    â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                         â”‚
â”‚  ç¼ºå¤±ç»„ä»¶ï¼ˆå› ç½‘ç»œé—®é¢˜ï¼‰:                  â”‚
â”‚  - Redis (çŠ¶æ€å­˜å‚¨)                      â”‚
â”‚  - Zipkin (è¿½è¸ª)                        â”‚
â”‚  - Dapr Sidecar (æœåŠ¡ç½‘æ ¼)              â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ æ¨èè¡ŒåŠ¨æ–¹æ¡ˆ

### çŸ­æœŸï¼ˆç«‹å³å¯ç”¨ï¼‰
1. âœ… ä½¿ç”¨å½“å‰éƒ¨ç½²è¿›è¡Œå¼€å‘å’Œæµ‹è¯•
2. âœ… æ‰€æœ‰REST APIåŠŸèƒ½å®Œå…¨å¯ç”¨
3. âœ… é€šè¿‡Gatewayè®¿é—®åç«¯æœåŠ¡

### ä¸­æœŸï¼ˆä¼˜åŒ–ï¼‰
1. å°è¯•æ–¹æ¡ˆ4é…ç½®é•œåƒåŠ é€Ÿå™¨
2. æˆ–ä½¿ç”¨æ–¹æ¡ˆ3å®‰è£…Memuraiä½œä¸ºRedisæ›¿ä»£
3. æ‰‹åŠ¨é…ç½®ç®€å•çš„è¿½è¸ªæ—¥å¿—

### é•¿æœŸï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰
1. è§£å†³ç½‘ç»œè®¿é—®é—®é¢˜
2. æˆ–ä½¿ç”¨ç¦»çº¿é•œåƒåŒ…
3. éƒ¨ç½²å®Œæ•´çš„Dapr + Redis + Zipkinå †æ ˆ

## ğŸ§ª åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | å½“å‰çŠ¶æ€ | éœ€è¦çš„ç»„ä»¶ | æ›¿ä»£æ–¹æ¡ˆ |
|------|---------|-----------|----------|
| REST API | âœ… å¯ç”¨ | - | - |
| API Gateway | âœ… å¯ç”¨ | - | - |
| æœåŠ¡é—´é€šä¿¡ | âœ… å¯ç”¨ | - | - |
| å¥åº·æ£€æŸ¥ | âœ… å¯ç”¨ | - | - |
| çŠ¶æ€æŒä¹…åŒ– | âŒ ä¸å¯ç”¨ | Redis | æ–¹æ¡ˆ3: Memurai |
| åˆ†å¸ƒå¼è¿½è¸ª | âŒ ä¸å¯ç”¨ | Zipkin | æ‰‹åŠ¨æ—¥å¿— |
| æœåŠ¡å‘ç° | âŒ ä¸å¯ç”¨ | Dapr | é™æ€é…ç½®ï¼ˆå·²æœ‰ï¼‰ |
| Pub/Sub | âŒ ä¸å¯ç”¨ | Dapr+Redis | å†…å­˜ç»„ä»¶ |
| Actoræ¨¡å‹ | âŒ ä¸å¯ç”¨ | Dapr+Placement | ä¸æ”¯æŒ |

## ğŸ“ éªŒè¯å½“å‰éƒ¨ç½²

è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯æœåŠ¡æ­£å¸¸ï¼š

```powershell
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
.\deploy-local.ps1 -Action status

# æµ‹è¯•API
curl http://localhost:5000/api/users
curl http://localhost:5000/api/products

# æŸ¥çœ‹æ—¥å¿—
podman logs go-nomads-gateway
podman logs go-nomads-product-service
podman logs go-nomads-user-service
```

## ğŸ†˜ åç»­æ”¯æŒ

å¦‚æœéœ€è¦å®Œæ•´åŠŸèƒ½ï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. **VPN/ä»£ç†**ï¼šè§£å†³ç½‘ç»œè®¿é—®é—®é¢˜
2. **ç¦»çº¿é•œåƒåŒ…**ï¼šä»å¯è®¿é—®çš„ç¯å¢ƒä¸‹è½½é•œåƒåŒ…
3. **ç§æœ‰é•œåƒä»“åº“**ï¼šåœ¨å†…ç½‘æ­å»ºé•œåƒä»“åº“
4. **äº‘æœåŠ¡**ï¼šä½¿ç”¨äº‘æœåŠ¡å•†çš„å®¹å™¨æœåŠ¡

---

**å½“å‰ç»“è®º**: æ ¸å¿ƒå¾®æœåŠ¡åŠŸèƒ½å·²ç»å¯ç”¨ï¼Œå¯ä»¥è¿›è¡Œå¼€å‘å’Œæµ‹è¯•ã€‚Daprç›¸å…³åŠŸèƒ½å¯ä»¥åç»­é€šè¿‡ä¸Šè¿°æ–¹æ¡ˆé€æ­¥æ·»åŠ ã€‚

**æœ€åæ›´æ–°**: 2025å¹´10æœˆ9æ—¥
