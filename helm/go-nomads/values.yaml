# Go-Nomads Helm Chart Values
# 全局配置
global:
  # 命名空间
  namespace: go-nomads
  
  # Docker Registry 配置
  imageRegistry: swr.ap-southeast-3.myhuaweicloud.com/go-nomads
  imageTag: latest
  imagePullPolicy: Always
  
  # 镜像拉取密钥
  imagePullSecrets:
    - name: docker-registry-secret
  
  # 环境
  environment: Production

# ConfigMap 配置
config:
  aspnetcoreEnvironment: "Production"
  redis:
    host: "redis-service"
    port: "6379"
  rabbitmq:
    host: "rabbitmq-service"
    port: "5672"
    managementPort: "15672"
  elasticsearch:
    host: "elasticsearch-service"
    port: "9200"
  consul:
    host: "consul-service"
    port: "8500"
  zipkin:
    host: "zipkin-service"
    port: "9411"
  # 服务 URLs (自动生成)
  serviceUrls:
    gateway: "http://gateway-service:80"
    userService: "http://user-service:80"
    cityService: "http://city-service:8002"
    coworkingService: "http://coworking-service:8003"
    accommodationService: "http://accommodation-service:8004"
    eventService: "http://event-service:8005"
    aiService: "http://ai-service:8080"
    messageService: "http://message-service:8010"
    cacheService: "http://cache-service:8011"

# Secrets 配置 (部署时覆盖)
secrets:
  # 数据库
  databaseConnectionString: "Host=postgres-service;Port=5432;Database=go_nomads;Username=postgres;Password=changeme"
  # Redis
  redisConnectionString: "redis-service:6379,abortConnect=false"
  # RabbitMQ
  rabbitmqUser: "guest"
  rabbitmqPassword: "guest"
  # Supabase
  supabaseUrl: "https://your-project.supabase.co"
  supabaseKey: "your-supabase-key"
  supabaseServiceRoleKey: "your-service-role-key"
  # AI Keys
  openaiApiKey: ""
  qianwenApiKey: ""
  deepseekApiKey: ""
  # Grafana
  grafanaAdminPassword: "admin"
  # Docker Registry (base64 encoded)
  dockerConfigJson: "e30="

# ============ 服务配置 ============

# Gateway
gateway:
  enabled: true
  replicaCount: 2
  image:
    repository: go-nomads-gateway
    tag: ""  # 使用 global.imageTag
  service:
    type: ClusterIP
    port: 80
    targetPort: 8080
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70
  ingress:
    enabled: true
    className: nginx
    host: api.go-nomads.com
    tls:
      enabled: true
      secretName: go-nomads-tls

# User Service
userService:
  enabled: true
  replicaCount: 2
  image:
    repository: go-nomads-user-service
    tag: ""
  service:
    type: ClusterIP
    port: 80
    targetPort: 80
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

# City Service
cityService:
  enabled: true
  replicaCount: 2
  image:
    repository: go-nomads-city-service
    tag: ""
  service:
    type: ClusterIP
    port: 8002
    targetPort: 8002
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

# Coworking Service
coworkingService:
  enabled: true
  replicaCount: 2
  image:
    repository: go-nomads-coworking-service
    tag: ""
  service:
    type: ClusterIP
    port: 8003
    targetPort: 8003
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

# Accommodation Service
accommodationService:
  enabled: true
  replicaCount: 1
  image:
    repository: go-nomads-accommodation-service
    tag: ""
  service:
    type: ClusterIP
    port: 8004
    targetPort: 8004
  resources:
    requests:
      memory: "256Mi"
      cpu: "50m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 3
    targetCPUUtilizationPercentage: 70

# Event Service
eventService:
  enabled: true
  replicaCount: 2
  image:
    repository: go-nomads-event-service
    tag: ""
  service:
    type: ClusterIP
    port: 8005
    targetPort: 8005
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

# AI Service
aiService:
  enabled: true
  replicaCount: 2
  image:
    repository: go-nomads-ai-service
    tag: ""
  service:
    type: ClusterIP
    port: 8080
    targetPort: 8080
  resources:
    requests:
      memory: "512Mi"
      cpu: "200m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

# Message Service
messageService:
  enabled: true
  replicaCount: 2
  image:
    repository: go-nomads-message-service
    tag: ""
  service:
    type: ClusterIP
    port: 8010
    targetPort: 8010
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

# Cache Service
cacheService:
  enabled: true
  replicaCount: 2
  image:
    repository: go-nomads-cache-service
    tag: ""
  service:
    type: ClusterIP
    port: 8011
    targetPort: 8011
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

# ============ 基础设施 ============

# Redis
redis:
  enabled: true
  image:
    repository: redis
    tag: "7-alpine"
  service:
    type: ClusterIP
    port: 6379
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  persistence:
    enabled: true
    size: 5Gi
    storageClass: ""  # 使用默认存储类

# RabbitMQ
rabbitmq:
  enabled: true
  image:
    repository: rabbitmq
    tag: "3-management-alpine"
  service:
    type: ClusterIP
    port: 5672
    managementPort: 15672
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  persistence:
    enabled: true
    size: 5Gi
    storageClass: ""

# Elasticsearch
elasticsearch:
  enabled: false  # 可选，默认禁用
  image:
    repository: elasticsearch
    tag: "8.11.0"
  service:
    type: ClusterIP
    port: 9200
  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1000m"
  persistence:
    enabled: true
    size: 10Gi
    storageClass: ""

# Consul
consul:
  enabled: false  # 可选，默认禁用
  image:
    repository: consul
    tag: "1.15"
  service:
    type: ClusterIP
    port: 8500
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

# ============ 监控 ============

# Prometheus
prometheus:
  enabled: false
  image:
    repository: prom/prometheus
    tag: "v2.47.0"
  service:
    type: ClusterIP
    port: 9090
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  persistence:
    enabled: true
    size: 10Gi
    storageClass: ""

# Grafana
grafana:
  enabled: false
  image:
    repository: grafana/grafana
    tag: "10.1.0"
  service:
    type: ClusterIP
    port: 3000
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"
  persistence:
    enabled: true
    size: 5Gi
    storageClass: ""

# Zipkin
zipkin:
  enabled: false
  image:
    repository: openzipkin/zipkin
    tag: "2.24"
  service:
    type: ClusterIP
    port: 9411
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
